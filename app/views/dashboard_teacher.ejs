<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title><%= title %></title>
	<link rel="stylesheet" href="/style.css" />
</head>
<body>
<header>
	<div>–î–∞—à–±–æ—Ä–¥ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</div>
	<div class="nav">
		<form class="inline" method="get" action="/dashboard" style="display:flex;align-items:center;gap:8px;">
			<input type="hidden" name="offset" value="<%= offset %>">
			<button class="btn secondary" name="dir" value="prev">¬´</button>
			<input type="number" name="amount" value="<%= amount || 1 %>" min="1" style="width:64px">
			<span><small class="muted">–ù–µ–¥–µ–ª—è: <%= weekRangeLabel %></small></span>
			<button class="btn secondary" name="dir" value="next">¬ª</button>
		</form>
		<button class="btn link" id="themeToggle" type="button" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
		<a href="https://uni-dubna.ru/" target="_blank" rel="noopener" class="btn link">–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</a>
		<span><small class="muted"><%= currentUser.fullName %> ‚Ä¢ –ø—Ä–µ–¥–º–µ—Ç: <strong><%= mySubject %></strong></small></span>
		<a href="/logout">–í—ã–π—Ç–∏</a>
	</div>
</header>
<div class="container">
	<div class="grid">
		<div class="card">
			<div class="section-title"><h3>1. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3></div>
			<% const dayOrder = ['mon','tue','wed','thu','fri','sat','sun']; const dayLabel = {mon:'–ü–Ω',tue:'–í—Ç',wed:'–°—Ä',thu:'–ß—Ç',fri:'–ü—Ç',sat:'–°–±',sun:'–í—Å'}; %>
			<% dayOrder.forEach(d => { const items = schedule.filter(s => s.dayOfWeek === d); if (!items.length) return; %>
				<h4><%= dayLabel[d] %></h4>
				<table class="table">
					<thead><tr><th>–í—Ä–µ–º—è</th><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–ì—Ä—É–ø–ø–∞</th><th>–ê—É–¥./–ü—Ä–µ–ø.</th></tr></thead>
					<tbody>
						<% items.forEach(it => { const isMine = it.subject === mySubject; %>
							<tr class="<%= isMine ? 'highlight' : '' %>">
								<td><%= it.startTime %> - <%= it.endTime %></td>
								<td><%= it.subject %> <%- (isMine ? '<span class="badge teacher">–º–æ—ë</span>' : '') %></td>
								<td><%= it.groupName %></td>
								<td><small class="muted"><%= it.room || '-' %> ‚Ä¢ <%= it.teacherName || '-' %></small></td>
							</tr>
						<% }) %>
					</tbody>
				</table>
			<% }) %>
		</div>
		<div class="card">
			<div class="section-title"><h3>2. –î–ó (–º–æ—ë)</h3></div>
			<h4>–î–æ–±–∞–≤–∏—Ç—å –î–ó</h4>
			<form method="post" action="/assignments/create">
				<label>–ì—Ä—É–ø–ø–∞ (4 —Ü–∏—Ñ—Ä—ã)</label>
				<select id="groupSelect" name="groupName" required>
					<option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É ‚Äî</option>
					<% (groups || []).forEach(g => { %>
						<option value="<%= g %>"><%= g %></option>
					<% }) %>
				</select>
				<label>–ü—Ä–µ–¥–º–µ—Ç</label>
				<input name="subjectText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–∏–Ω–µ–π–Ω–∞—è –∞–ª–≥–µ–±—Ä–∞" required />
				<label>–ü–∞—Ä–∞ (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ)</label>
				<select id="pairSelect" name="scheduleId" required>
					<option value="">‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—É ‚Äî</option>
					<% schedule.forEach(s => { %>
						<option data-group="<%= s.groupName %>" value="<%= s.id %>"><%= s.groupName %> ‚Ä¢ <%= s.dayOfWeek %> ‚Ä¢ <%= s.startTime %>-<%= s.endTime %></option>
					<% }) %>
				</select>
				<label>–ó–∞–¥–∞–Ω–∏–µ</label>
				<textarea name="homework" required></textarea>
				<label>–î–µ–¥–ª–∞–π–Ω</label>
				<input type="datetime-local" name="dueDate" required />
				<div style="margin-top:8px"><button class="btn" type="submit">–°–æ–∑–¥–∞—Ç—å</button></div>
			</form>
			<script>
			(function(){
				var g = document.getElementById('groupSelect');
				var p = document.getElementById('pairSelect');
				function filterPairs(){
					var val = g.value;
					Array.from(p.options).forEach(function(opt){
						if (!opt.value) return;
						opt.hidden = (val && opt.getAttribute('data-group') !== val);
					});
				}
				g && g.addEventListener('change', filterPairs);
				filterPairs();
			})();
			</script>

			<h4 style="margin-top:16px;">–°–ø–∏—Å–æ–∫</h4>
			<% if (!assignments.length) { %>
				<p><small class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –≤–∞—à–∏—Ö –∑–∞–¥–∞–Ω–∏–π –≤ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é</small></p>
			<% } %>
			<% assignments.forEach(a => { %>
				<div style="border-bottom:1px solid #eee; padding:8px 0;">
					<form class="inline" method="post" action="/assignments/<%= a.id %>/update">
						<div><strong><%= a.displaySubject %></strong> ‚Ä¢ <%= a.groupName %> ‚Ä¢ <%= a.dayOfWeek %> ‚Ä¢ <%= a.startTime %>-<%= a.endTime %></div>
						<label>–ü—Ä–µ–¥–º–µ—Ç</label>
						<input name="subjectText" value="<%= a.subjectText || a.displaySubject %>" />
						<label>–ó–∞–¥–∞–Ω–∏–µ</label>
						<textarea name="homework"><%= a.homework %></textarea>
						<div class="grid-2">
							<div>
								<label>–î–µ–¥–ª–∞–π–Ω</label>
								<input type="datetime-local" name="dueDate" value="<%= (new Date(a.dueDate)).toISOString().slice(0,16) %>" />
							</div>
							<div>
								<label>–î–æ–ø. –¥–µ–¥–ª–∞–π–Ω</label>
								<input type="datetime-local" name="extendedDueDate" value="<%= a.extendedDueDate ? (new Date(a.extendedDueDate)).toISOString().slice(0,16) : '' %>" />
							</div>
						</div>
						<label>–®—Ç—Ä–∞—Ñ (–±–∞–ª–ª—ã)</label>
						<input type="number" name="extendedPenalty" value="<%= a.extendedPenalty || '' %>" />
						<div style="margin-top:8px; display:flex; gap:8px;">
							<button class="btn" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
						</div>
					</form>
					<form class="inline" method="post" action="/assignments/<%= a.id %>/delete" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ?')">
						<button class="btn danger" type="submit">–£–¥–∞–ª–∏—Ç—å</button>
					</form>
					<% if (a.createdAt) { %><div><small class="muted">–î–æ–±–∞–≤–ª–µ–Ω–æ: <%= new Date(a.createdAt).toLocaleString() %></small></div><% } %>
				</div>
			<% }) %>
		</div>
		<div class="card">
			<div class="section-title"><h3>3. –î–µ–¥–ª–∞–π–Ω—ã</h3></div>
			<% if (!assignments.length) { %>
				<p><small class="muted">–ù–µ—Ç –¥–µ–¥–ª–∞–π–Ω–æ–≤ –≤ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é</small></p>
			<% } %>
			<% assignments.forEach(a => { %>
				<div style="border-bottom:1px solid #eee; padding:8px 0;">
					<div><strong><%= a.homework %></strong> ‚Äî —Å—Ä–æ–∫: <strong><%= new Date(a.dueDate).toLocaleString() %></strong></div>
					<% if (a.extendedDueDate) { %>
						<div>–¥–æ–ø. —Å—Ä–æ–∫: <strong><%= new Date(a.extendedDueDate).toLocaleString() %></strong> <%= a.extendedPenalty ? '(—à—Ç—Ä–∞—Ñ: -' + a.extendedPenalty + ' –±.)' : '' %></div>
					<% } %>
					<small class="muted"><%= a.displaySubject %> ‚Ä¢ <%= a.groupName %></small>
				</div>
			<% }) %>
		</div>
		<div class="card">
			<div class="section-title"><h3>4. –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3></div>
			<% if (!events.length) { %>
				<p><small class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –≤ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é</small></p>
			<% } %>
			<% events.forEach(e => { const mine = e.subject === mySubject; %>
				<div style="border-bottom:1px solid #eee; padding:8px 0;" class="<%= mine ? 'highlight' : '' %>">
					<div><strong><%= e.title %></strong> <%= mine ? '<span class="badge teacher">–º–æ—ë</span>' : '' %></div>
					<div><small class="muted"><%= e.date %> ‚Ä¢ <%= e.startTime %>-<%= e.endTime %></small></div>
					<% if (e.subject) { %><div><span class="badge"><%= e.subject %></span> <small class="muted">/ <%= e.groupName || '–≤—Å–µ –≥—Ä—É–ø–ø—ã' %></small></div><% } %>
					<% if (e.description) { %><div><small><%= e.description %></small></div><% } %>
					<% if (e.createdAt) { %><div><small class="muted">–î–æ–±–∞–≤–ª–µ–Ω–æ: <%= e.createdAt %></small></div><% } %>
				</div>
			<% }) %>
		</div>
	</div>
</div>
<script src="/theme.js"></script>
</body>
</html>
