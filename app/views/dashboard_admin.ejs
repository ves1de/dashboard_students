<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title><%= title %></title>
	<link rel="stylesheet" href="/style.css" />
</head>
<body>
<header>
	<div>–î–∞—à–±–æ—Ä–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
	<div class="nav">
		<form class="inline" method="get" action="/dashboard" style="display:flex;align-items:center;gap:8px;">
			<input type="hidden" name="offset" value="<%= offset %>">
			<button class="btn secondary" name="dir" value="prev">¬´</button>
			<input type="number" name="amount" value="<%= amount || 1 %>" min="1" style="width:64px">
			<span><small class="muted">–ù–µ–¥–µ–ª—è: <%= weekRangeLabel %></small></span>
			<button class="btn secondary" name="dir" value="next">¬ª</button>
		</form>
		<button class="btn link" id="themeToggle" type="button" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
		<a href="https://uni-dubna.ru/" target="_blank" rel="noopener" class="btn link">–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</a>
		<span><small class="muted"><%= currentUser.fullName %></small></span>
		<a href="/logout">–í—ã–π—Ç–∏</a>
	</div>
</header>
<div class="container">
	<div class="grid-2">
		<div class="card">
			<div class="section-title"><h3>1. –ü–æ–ª–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3></div>
			<% const dayOrder = ['mon','tue','wed','thu','fri','sat','sun']; const dayLabel = {mon:'–ü–Ω',tue:'–í—Ç',wed:'–°—Ä',thu:'–ß—Ç',fri:'–ü—Ç',sat:'–°–±',sun:'–í—Å'}; %>
			<% dayOrder.forEach(d => { const items = schedule.filter(s => s.dayOfWeek === d); if (!items.length) return; %>
				<h4><%= dayLabel[d] %></h4>
				<table class="table">
					<thead><tr><th>–í—Ä–µ–º—è</th><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–ì—Ä—É–ø–ø–∞</th><th>–ê—É–¥./–ü—Ä–µ–ø.</th><th></th></tr></thead>
					<tbody>
						<% items.forEach(it => { %>
							<tr>
								<td><%= it.startTime %> - <%= it.endTime %></td>
								<td><%= it.subject %></td>
								<td><%= it.groupName %></td>
								<td><small class="muted"><%= it.room || '-' %> ‚Ä¢ <%= it.teacherName || '-' %></small></td>
								<td>
									<form class="inline" method="post" action="/schedule/<%= it.id %>/delete" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–∞—Ä—É?')">
										<button class="btn danger" type="submit">–£–¥–∞–ª–∏—Ç—å</button>
									</form>
								</td>
							</tr>
							<tr>
								<td colspan="5">
									<form method="post" action="/schedule/<%= it.id %>/update" class="grid-4">
										<div>
											<label>–î–µ–Ω—å</label>
											<select name="dayOfWeek">
												<option value="mon" <%= it.dayOfWeek==='mon'?'selected':'' %>>–ü–Ω</option>
												<option value="tue" <%= it.dayOfWeek==='tue'?'selected':'' %>>–í—Ç</option>
												<option value="wed" <%= it.dayOfWeek==='wed'?'selected':'' %>>–°—Ä</option>
												<option value="thu" <%= it.dayOfWeek==='thu'?'selected':'' %>>–ß—Ç</option>
												<option value="fri" <%= it.dayOfWeek==='fri'?'selected':'' %>>–ü—Ç</option>
												<option value="sat" <%= it.dayOfWeek==='sat'?'selected':'' %>>–°–±</option>
												<option value="sun" <%= it.dayOfWeek==='sun'?'selected':'' %>>–í—Å</option>
											</select>
										</div>
										<div>
											<label>–ù–∞—á–∞–ª–æ</label>
											<input type="time" name="startTime" value="<%= it.startTime %>" />
										</div>
										<div>
											<label>–ö–æ–Ω–µ—Ü</label>
											<input type="time" name="endTime" value="<%= it.endTime %>" />
										</div>
										<div>
											<label>–ü—Ä–µ–¥–º–µ—Ç</label>
											<input name="subject" value="<%= it.subject %>" />
										</div>
										<div>
											<label>–ì—Ä—É–ø–ø–∞ (4 —Ü–∏—Ñ—Ä—ã)</label>
										<input name="groupName" value="<%= it.groupName %>" pattern="[0-9]{4}" />
										</div>
										<div>
											<label>–ê—É–¥–∏—Ç–æ—Ä–∏—è</label>
											<input name="room" value="<%= it.room || '' %>" />
										</div>
										<div>
											<label>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</label>
											<input name="teacherName" value="<%= it.teacherName || '' %>" />
										</div>
										<div style="display:flex;align-items:end">
											<button class="btn" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
										</div>
									</form>
								</td>
							</tr>
						<% }) %>
					</tbody>
				</table>
			<% }) %>
			<h4 style="margin-top:12px;">–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—É</h4>
			<form method="post" action="/schedule/create" class="grid-4">
				<div>
					<label>–î–µ–Ω—å</label>
					<select name="dayOfWeek" required>
						<option value="mon">–ü–Ω</option>
						<option value="tue">–í—Ç</option>
						<option value="wed">–°—Ä</option>
						<option value="thu">–ß—Ç</option>
						<option value="fri">–ü—Ç</option>
						<option value="sat">–°–±</option>
						<option value="sun">–í—Å</option>
					</select>
				</div>
				<div>
					<label>–ù–∞—á–∞–ª–æ</label>
					<input type="time" name="startTime" required />
				</div>
				<div>
					<label>–ö–æ–Ω–µ—Ü</label>
					<input type="time" name="endTime" required />
				</div>
				<div>
					<label>–ü—Ä–µ–¥–º–µ—Ç</label>
					<input name="subject" required />
				</div>
				<div>
					<label>–ì—Ä—É–ø–ø–∞ (4 —Ü–∏—Ñ—Ä—ã)</label>
					<input name="groupName" required pattern="[0-9]{4}" />
				</div>
				<div>
					<label>–ê—É–¥–∏—Ç–æ—Ä–∏—è</label>
					<input name="room" />
				</div>
				<div>
					<label>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</label>
					<input name="teacherName" />
				</div>
				<div style="display:flex;align-items:end">
					<button class="btn" type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
				</div>
			</form>
		</div>
		<div class="card">
			<div class="section-title"><h3>2. –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (CRUD)</h3></div>
			<h4>–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h4>
			<form method="post" action="/events/create">
				<label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
				<input name="title" required />
				<label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
				<textarea name="description"></textarea>
				<div class="grid-3">
					<div>
						<label>–î–∞—Ç–∞</label>
						<input type="date" name="date" required />
					</div>
					<div>
						<label>–ù–∞—á–∞–ª–æ</label>
						<input type="time" name="startTime" required />
					</div>
					<div>
						<label>–ö–æ–Ω–µ—Ü</label>
						<input type="time" name="endTime" required />
					</div>
				</div>
				<label>–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ –ø–∞—Ä–µ (–æ–ø—Ü., –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–¥—Å–≤–µ—Ç–∫—É —É –ø—Ä–µ–ø–æ–¥–∞)</label>
				<select name="scheduleId">
					<option value="">‚Äî –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ ‚Äî</option>
					<% schedule.forEach(s => { %>
						<option value="<%= s.id %>"><%= s.subject %> ‚Ä¢ <%= s.groupName %> ‚Ä¢ <%= s.dayOfWeek %> ‚Ä¢ <%= s.startTime %>-<%= s.endTime %></option>
					<% }) %>
				</select>
				<label>–ì—Ä—É–ø–ø–∞ (–æ–ø—Ü., –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ ‚Äî –¥–ª—è –≤—Å–µ—Ö)</label>
				<input name="groupName" />
				<div style="margin-top:8px"><button class="btn" type="submit">–°–æ–∑–¥–∞—Ç—å</button></div>
			</form>

			<h4 style="margin-top:16px;">–°–ø–∏—Å–æ–∫</h4>
			<% if (!events.length) { %>
				<p><small class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –≤ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é</small></p>
			<% } %>
			<% events.forEach(e => { %>
				<div style="border-bottom:1px solid #eee; padding:8px 0;">
					<form class="inline" method="post" action="/events/<%= e.id %>/update">
						<label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
						<input name="title" value="<%= e.title %>" />
						<label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
						<textarea name="description"><%= e.description || '' %></textarea>
						<div class="grid-3">
							<div>
								<label>–î–∞—Ç–∞</label>
								<input type="date" name="date" value="<%= e.date %>" />
							</div>
							<div>
								<label>–ù–∞—á–∞–ª–æ</label>
								<input type="time" name="startTime" value="<%= e.startTime %>" />
							</div>
							<div>
								<label>–ö–æ–Ω–µ—Ü</label>
								<input type="time" name="endTime" value="<%= e.endTime %>" />
							</div>
						</div>
						<label>–ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–∞—Ä–µ</label>
						<select name="scheduleId">
							<option value="">‚Äî –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ ‚Äî</option>
							<% schedule.forEach(s => { %>
								<option value="<%= s.id %>" <%= e.scheduleId === s.id ? 'selected' : '' %>><%= s.subject %> ‚Ä¢ <%= s.groupName %> ‚Ä¢ <%= s.dayOfWeek %> ‚Ä¢ <%= s.startTime %>-<%= s.endTime %></option>
							<% }) %>
						</select>
						<label>–ì—Ä—É–ø–ø–∞</label>
						<input name="groupName" value="<%= e.groupName || '' %>" />
						<div style="margin-top:8px; display:flex; gap:8px;">
							<button class="btn" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
						</div>
					</form>
					<form class="inline" method="post" action="/events/<%= e.id %>/delete" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?')">
						<button class="btn danger" type="submit">–£–¥–∞–ª–∏—Ç—å</button>
					</form>
					<% if (e.createdAt) { %><div><small class="muted">–î–æ–±–∞–≤–ª–µ–Ω–æ: <%= e.createdAt %></small></div><% } %>
				</div>
			<% }) %>
		</div>
	</div>
</div>
<script src="/theme.js"></script>
</body>
</html>
